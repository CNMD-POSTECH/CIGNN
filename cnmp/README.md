# <span style="font-size:larger;">CNMP</span>

CNMP is the machine learning potential of the CIGNN (**Charge Integrated Graph Neural Network**) model for amorphous HfO2.

---

### <span style="font-size:larger;">Set Environment & Compile with LAMMPS</span>

1. Activate the environment: `conda activate cignn_env`
2. Clone the stable branch of LAMMPS: `git clone -b stable https://github.com/lammps/lammps.git lammps`
3. Set the environment parameters according to your system in the `build.sh`
4. Modify the config.yaml file to set the appropriate charge model path:
Open the config.yaml file and update the ['data']['q_model'] field to match the correct location of your charge model.
Example (config.yaml):
   ```data:
   q_model: ../modelset/q.pth.tar  # Update this path based on your environment
   ```
5. Build LAMMPS:  
   
   ```bash
   sh build.sh --path <lammps_path> --config <train_config_path> --checkpoint <trained_checkpoint_path>
   ```

   **Example:**

   ```bash
   sh build.sh --path ./lammps --config ../modelset/config.yaml --checkpoint ../modelset/efs.pth.tar
   ```

---

### <span style="font-size:larger;">Run LAMMPS</span>

    ```
    cd cnmp/example
    ```

    In your LAMMPS input, add:

    ```
    pair_style   CNMP/gpu 'cuda' /abs/path/to/CNMP 0.00 0.00 2
    pair_coeff   * *  CNMP Hf O
    ```

    - `CNMP/gpu <device or device:number> <CNMP_path> <start_field> <final_field> <axis>`  
    - **Current support:** constant field only (`start_field == final_field`)  
    - `axis` is `0, 1, 2` for `x, y, z`.

---

### <span style="font-size:larger;">Run LAMMPS w/ Field</span>

CNMP uses a polarization branch-cut shift cached as a `.npy` file.

**Create this cache first with `../script/run_pq.py`**, then run MD with an E-field using LAMMPS.

1) **E-field runs**  
   - Enable the field via `CNMP_initialize(..., e_field_list=[E, E, axis])`.  
   - Edit the top of `CNMP/prediction.py` and set the path to the `.npy` file generated by `run_pq.py`:
     ```
     NPY_PATH = 'CIGNN/try_1/pq.npy'  # set this to the .npy produced by run_pq.py
     ```

2) **When to refresh the cache**  
   - If the initial structure changes, or you switch to a different configuration:  
     R-egenerate it with `run_pq.py`, update the path in `CNMP/prediction.py`, and then rerun the LAMMPS MD simulation.

---

## <span style="font-size:larger;">Error</span>

If you encounter issues during installation or usage, please refer to the `error.txt` file for troubleshooting.  
If the issue persists, feel free to open an issue in this GitHub repository.

---

## <span style="font-size:larger;">References</span>

If you use CNMP in your research, please consider citing the following work:

- Hyo Gyeong Shin, Seong Hun Kim, Eun Ho Kim, Jun Hyeong Gu, Jaeseon Kim, Seon-Gyu Kim, Shin Hyun Kim, Youngjun Park, Hyo Kim, Sunghyun Kim, Duk-Hyun Choe, Donghwa Lee.  
  Charge Integrated Graph Neural Network-based Machine Learning Potential for Amorphous and Non-stoichiometric Hafnium Oxide

---